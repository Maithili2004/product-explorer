# Deployment Guide

This guide covers deploying Product Data Explorer to production.

## Prerequisites

- GitHub account with repository access
- Vercel account (for frontend)
- Railway/Render/Fly.io account (for backend)
- PostgreSQL instance (managed or self-hosted)
- Redis instance (managed or self-hosted)

## Frontend Deployment (Vercel)

### 1. Connect GitHub Repository

1. Go to [vercel.com](https://vercel.com)
2. Click "New Project"
3. Select your GitHub repository
4. Select "Next.js" as the framework

### 2. Configure Environment Variables

In Vercel project settings, add:

```
NEXT_PUBLIC_API_URL=https://your-backend-url/api/v1
NEXT_PUBLIC_APP_URL=https://your-frontend-url
```

### 3. Configure Build Settings

- **Root Directory**: `frontend`
- **Build Command**: `npm run build`
- **Output Directory**: `.next`

### 4. Deploy

Click "Deploy" - Vercel will automatically build and deploy on every push to main.

## Backend Deployment (Railway)

### 1. Prepare Docker Image

Ensure `backend/Dockerfile` is configured correctly.

### 2. Connect to Railway

1. Go to [railway.app](https://railway.app)
2. Create new project
3. Select "GitHub" and connect your repository

### 3. Configure Services

Create the following services in Railway:

#### PostgreSQL Service

1. Add "PostgreSQL" from marketplace
2. Railway auto-generates `DATABASE_URL`

#### Redis Service

1. Add "Redis" from marketplace
2. Railway auto-generates `REDIS_URL`

#### Backend Service

1. Add "GitHub Repo" from marketplace
2. Select your repository and `backend` directory

### 4. Configure Environment Variables

Set in Railway project settings:

```
NODE_ENV=production
LOG_LEVEL=info
DATABASE_URL=<auto-generated by Railway>
REDIS_URL=<auto-generated by Railway>
PORT=3001
API_PREFIX=api
API_VERSION=v1
CORS_ORIGIN=https://your-frontend-url.vercel.app
WOB_BASE_URL=https://www.worldofbooks.com
```

### 5. Configure Build and Deploy

- **Build Command**: `npm run build`
- **Start Command**: `npm run start`
- **Port**: `3001`

### 6. Deploy

Click "Deploy" - Railway will build and deploy automatically.

## Alternative: Fly.io

### 1. Install Fly CLI

```bash
curl -L https://fly.io/install.sh | sh
```

### 2. Authenticate

```bash
fly auth login
```

### 3. Create fly.toml

In backend directory:

```toml
app = "product-explorer-backend"

[build]
builder = "heroku"
buildpacks = ["heroku/nodejs"]

[env]
NODE_ENV = "production"
LOG_LEVEL = "info"

[services]
  internal_port = 3001
  protocol = "tcp"

  [[services.ports]]
    handlers = ["http"]
    port = 80

  [[services.ports]]
    handlers = ["tls", "http"]
    port = 443

[postgres]
internal_port = 5432
```

### 4. Deploy

```bash
fly deploy
```

### 5. Set Secrets

```bash
fly secrets set DATABASE_URL="postgresql://user:password@host/db"
fly secrets set REDIS_URL="redis://host:port"
fly secrets set CORS_ORIGIN="https://your-frontend-url"
```

## Database Migration

### Initial Setup

```bash
# Ensure database is running
# Then run migrations from backend directory

npm run migrate
npm run seed
```

### For Production

Use managed PostgreSQL (Railway/Render/AWS RDS):

1. Create database instance
2. Get connection string
3. Set as `DATABASE_URL` environment variable
4. Run migrations: `npm run migrate`
5. (Optional) Run seeders: `npm run seed`

## Monitoring & Logging

### Vercel

- Built-in analytics and monitoring
- View logs in Vercel dashboard
- Real-time error tracking

### Railway

- View logs in deployment logs
- Monitor resource usage
- Set up alerts

### Fly.io

- View logs: `fly logs`
- Monitor: `fly status`
- Dashboard at fly.io

## Security Checklist

- [ ] Remove all hardcoded secrets
- [ ] All env variables are configured
- [ ] Database backups are enabled
- [ ] SSL/TLS certificates are active
- [ ] CORS properly configured for your domain
- [ ] Rate limiting enabled on API
- [ ] Database is not publicly accessible
- [ ] Redis has password protection
- [ ] GitHub secrets are configured for CI/CD

## Custom Domain

### Vercel

1. Go to project settings
2. Domains section
3. Add custom domain
4. Follow DNS configuration steps

### Railway/Fly.io

1. Add custom domain in project settings
2. Update DNS CNAME record
3. Wait for DNS propagation (up to 48 hours)

## Continuous Deployment

Push to main branch triggers:

1. GitHub Actions CI pipeline
2. Lint and tests run
3. If successful:
   - Vercel auto-deploys frontend
   - Railway/Fly auto-deploys backend

## Rollback

### Vercel

1. Go to Deployments
2. Select previous deployment
3. Click "Promote to Production"

### Railway

1. Go to Deployments
2. Select previous deployment
3. Click "Redeploy"

### Fly.io

```bash
fly releases
fly release rollback
```

## Troubleshooting

### Database Connection Issues

```bash
# Test connection
psql $DATABASE_URL -c "SELECT 1"

# Check environment variables
fly secrets list
```

### Redis Connection Issues

```bash
# Test Redis
redis-cli -u $REDIS_URL ping
```

### Build Failures

1. Check build logs in dashboard
2. Ensure all environment variables are set
3. Verify package.json scripts exist
4. Check Node version compatibility

### Performance Issues

1. Enable database query logging
2. Check slow logs
3. Optimize database indexes
4. Consider caching layer (Redis)

## Support

- GitHub Issues: Report bugs
- Documentation: See README.md
- Community: Discuss in issues

## Next Steps

After deployment:

1. Test all features in production
2. Monitor error logs
3. Set up alerting
4. Configure backups
5. Document your setup
